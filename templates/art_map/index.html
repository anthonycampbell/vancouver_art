<!DOCTYPE html>

{% load staticfiles %}

<html>
  <head>
    <style>
      #map {
        width: 100%;
        height: 400px;
        background-color: grey;
      }
    </style>
    <script type=text/javascript>
      var art = JSON.parse({{ art|safe }});
    </script>
  </head>
  <body>
    <h1>Vancouver Art</h1>
    <!--The div element for the map -->
    <div id="map"></div>
	<script type=text/javascript>
	  function initMap() {
	    var vancouver = {lat: 49.2827, lng: -123.1207};
	    var img = {url: '/static/pics/fancy-icon.png', scaledSize: new google.maps.Size(20, 20)};
	    var map = new google.maps.Map(document.getElementById('map'), {zoom: 11, center: vancouver});
	    var infowindow = new google.maps.InfoWindow({maxWidth: 200});
	    var title;
	    var lat;
	    var lon;
	    var point;
	    var marker;
	    var photoURL;
	    var description;
	    var art_id;
	    for (i = 0; i < art.length; i++){
	      art_id = art[i].pk;
	      title = art[i].fields['title'];
	      description = art[i].fields['description'];
	      photoURL = art[i].fields['photoURL'];
	      lat = art[i].fields['lat'];
	      lon = art[i].fields['lon'];
	      if (lat && lon){
		point = {lat: lat, lng: lon};
		marker = new google.maps.Marker({position: point, map: map, icon: img});
		google.maps.event.addListener(marker, 'click', (function (marker, art_id, title, description, photoURL) {
		  return function() {
		    infowindow.setContent("<div style=\"max-height:150px\";\"overflow-y:auto\">" +
					  "<form id=\"add_favourite_form\" method=\"post\" action=\"/art_map/add_favourite/\">" +
					  "{% csrf_token %}" +
					  "<input type=\"hidden\" id=\"art_id\" name=\"art_id\" value="+art_id+">" +
					  "<b>"+title+"</b><br/>" +
					  "Description: "+description+"<br/>" +
					  "Photo:<a href="+photoURL+">"+photoURL+"</a><br/>" +
					  "<input type=\"submit\" value=\"favourite\"/><br/>" +
					  "</form><br/>" +
					  "</div>");
		    infowindow.open(map, marker);
		  }
		})(marker, art_id, title, description, photoURL));
	      }
	    }
	  }
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key={{ key }}&callback=initMap"
	async defer></script>
    {% if user.is_authenticated %}
    <a href="/art_map/logout/">Logout</a><br/>
    {% else %}
    <a href="/art_map/register/">Register Here</a><br/>
    <a href="/art_map/login/">Login</a><br/>
    {% endif %}
    <a href="/art_map/profile/">Profile</a><br/>
  </body>
</html>
